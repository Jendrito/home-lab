1. Ya dentro de Kali Linux, en la parte de arriba a la derecha veremos uno de los íconos girar (o directamente una cruz sobre un puerto Ethernet) y, que por momentos nos sale un cartel de que está desconectado de internet. Esto es porque debemos asignar la IP de la LAN que previamente elegimos en pfSense. Para ello, damos click derecho sobre el ícono y elegimos "Editar las conexiones". Una vez dentro de "Conexiones de red", seleccionamos nuestra red (debe ser la única disponible) y vamos al engranaje para poder editar la red.

2. Una vez ingresado en el panel de edición de nuestra red, iremos a "Ajustes IPv4" y en "Método" elegiremos "Manual". En la sección "Dirección", seleccionamos "Añadir" y ahora deberemos completar los campos que se nos muestran. En mí caso, al haber elegido en la configuración de pfSense la red 192.168.60.1, elegiré como Dirección 192.168.60.10, Máscara de red 255.255.255.0 y Puerta de enlace 192.168.60.254. En servidores DNS preferidos, escribo 8.8.8.8 y guardo la configuración. Ahora, el ícono del puerto Ethernet debería estar sin la cruz y ya tendríamos conexión.

3. Para comprobar nuestra conexión, vamos a abrir una terminal en Kali y en la consola haremos ping con nuestra server. En mí caso, escribo ping 192.168.60.1 y resulta positivo.

4. Ahora abriremos Firefox (es el browser que viene por default en Kali) y escribimos el nombre de nuestro server para poder entrar en la interfaz gráfica de pfSense. Ante el mensaje de riesgo potencial, seleccionamos "Advanced" y luego "Accept the Risk and Continue". Ahora nos pedirá las credenciales para entrar en pfSense. Por default, el usuario es "admin" y la contraseña es "pfsense".

5. Una vez dentro, nos dará la bienvenida y seleccionaremos Next y nuevamente Next hasta llegar al Step 2 of 9, donde podemos elegir el nombre de nuestro server, el dominio y los servidores DNS principal y secundario. Ya configurado, damos Next y nos preguntará la zona horaria de nuestro servidor. Elegimos la que se adapte nuestra ubiación geográfica y damos Next.

6. En el paso 4, que nos pide configurar nuestra interfaz WAN, dejaremos todo como está y seleccionamos Next. Lo mismo sucederá en el paso 5, ya que nuestra interfaz LAN fue configurada previamente en la consola de pfSense.

7. En el paso 6, nos pedirá cambiar la contraseña de admin que viene por default. Una vez elegida, damos Next y nos pedirá recargar la configuración a lo que aceptamos. Avanzará directamente al paso 9 y damos en Finish para terminar la configuración base.

8. Ahora iremos a System -> Advanced -> Networking y veremos que en "Server Backend" esta seleccionada la opción "ISC DHCP (Deprecated)", por lo que debemos seleccionar la otra opción, "Kea DHCP" y además marcamos "Ignore Deprecation Warning". Vamos hasta abajo y damos en Save.

9. Ahora pasaremos a configurar el servidor DHCP para que nuestra máquina virtual Kali Linux pueda acceder a internet. Iremos a Services -> DHCP Server. Dentro de esta sección, habilitaremos "Enable DHCP server on LAN interface". En "Address Pool Range" podemos elegir el rango en el que se otorgarán las direcciones IP dentro de nuestro rango de subnet (en mí caso lo dejo como está). En "WINS Servers" y "DNS Servers" elijo mí servidor (en mí caso 192.168.60.1. El mismo valor pondré en "Gateaway". Finalmente, damos en Save y luego en Apply Changes.

10. Ahora, debemos volver a nuestra configuración de red en Kali Linux para cambiar nuestro Ajuste de IPv4 a "Automático" y así poder recibir una dirección IP desde nuestro servidor. Para comprobar que la IP fue dada a nuestra máquina virtual, volveremos a la interfaz de pfSense e iremos a Status -> DHCP Leases y debería aparecer nuestra máquina virtual. En el caso de que no aparezca, puede demorar un tiempo; actualizamos la página hasta que finalmente se muestre la asignación.  

11. Pasamos a configurar nuestro DNS Resolver. Para eso, vamos a Services -> DHCP Resolver y entraremos en la configuración del mismo. Debería ya estar activado y marcaremos las siguientes opciones: "Enable SSL/TLS Service", "DNS Query Forwarding" y "Use SSL/TLS for outgoing DNS Queries to Forwarding Servers". El resto lo dejamos como aparece; vamos a Save y luego Apply Changes. De esta manera, si en nuestro browser vamos, por ejemplo a google.com, ya deberíamos poder ingresar en el navegador. También podemos hacer las pruebas de ping 8.8.8.8 y dig google.como en nuestra termina del Kali Linux.